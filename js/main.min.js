/*
 * Copyright © 2014 by Steve Muller. All rights reserved.
 * You may not copy, reproduce, alter, create derivates of, redistribute or sell this work without
 * explicit permission of the author. This copyright notice must not be removed.
 *
 */
function lang(e){if(window.languagedict&&e in window.languagedict)return window.languagedict[e];else return e}function init(e,t){function d(e,t,n){var r=localStorage.toons?JSON.parse(localStorage.toons):{};var e=parseInt(localStorage.currentToonId);var i=r[e].fishes.indexOf(t);var s;if(i>=0&&(typeof n=="undefined"||!n)){r[e].fishes.splice(i,1);s=false}else if(i<0&&(typeof n=="undefined"||n)){r[e].fishes.push(t);s=true}localStorage.toons=JSON.stringify(r);return s}function v(t,i){t=$(t);var s=function(s){return function(o){t.empty();var u=$("<tbody/>").appendTo($("<table/>").addClass(i+"list pondorfishlist").appendTo(t));for(var a=0;a<o.length;a++){var f=o[a];var l=$("<tr/>").appendTo(u);if(i=="pond")$("<td/>").appendTo(l).attr("colspan","3").addClass("icon pond_"+f.id);else $("<td/>").appendTo(l).attr("colspan","3").addClass("icon fishgroup_"+f.group);var c=$("<td/>").appendTo(l).addClass("name");var h=e+(i=="pond"?"ponds/":"fishes/")+f.id+".html?rid="+s;$("<strong/>").appendTo(c).append($("<a/>").attr("href",h).text(lang(f.name)));if(f.samples){var p=$("<small/>").appendTo(c);for(var d=0;d<f.samples.length;d++){var v=f.samples[d];var h=e+(i=="pond"?"fishes/":"ponds/")+v.id+".html?rid="+s;$("<a/>").appendTo(p).attr("href",h).text(lang(v.name)+" ("+v.prob+")")}if(f.num_total_samples>f.samples.length)p.append(document.createTextNode(lang(" ... and $ more").replace(/\$/g,f.num_total_samples-f.samples.length)))}var m=$("<td/>").appendTo(l).addClass("probability");$("<strong/>").appendTo(m).text(f.prob);$("<small/>").appendTo(m).text(f.num_buckets<=1?lang("needs 1 bucket"):lang("needs $ buckets").replace(/\$/g,f.num_buckets))}if(o.length==0){var l=$("<tr/>").appendTo(u);var g=$("<td/>").appendTo(l).css("text-align","center").attr("colspan","3");if(i=="pond"||s==r)g.text(lang("You have caught all possible fish species with this rod."));else{$("<p/>").appendTo(g).text(lang("You have caught all fish species that are more common with $ than with later rods.").replace(/\$/g,n[s]));$("<p/>").appendTo(g).text(lang("You can safely buy a new rod from your cattlelog now."))}}}};var o=function(e,n,r){t.text(lang("Failed to retrieve data: ")+n+", "+r)};this.fetchAndRender=function(t,n){$.getJSON(e+i+"_advisor.json",{rid:t,fid:n}).done(s(t)).fail(o)}}function m(){var e=this;this.events={};this.createToonPanel=function(t){var r=$("<li/>").attr("id","toon_"+t.id);if(t.id==localStorage.currentToonId){r.addClass("current")}$("<p/>").appendTo(r).addClass("name").text(t.name);$("<p/>").appendTo(r).addClass("rod").text(n[t.rod]);$("<p/>").appendTo(r).addClass("fishes").text(lang("$/$ species").replace(/\$/,t.fishes.length).replace(/\$/,i[t.rod]));r.click(function(){localStorage.currentToonId=t.id;$(this).siblings("li").removeClass("current");$(this).addClass("current");$(e.events).trigger("onToonSelected",[t]);$(e.events).trigger("onToonSelectionChanged",[t])});return r};this.createUnselectPanel=function(){return $("<li/>").addClass("none").text("✘").click(function(){localStorage.removeItem("currentToonId");$(this).siblings("li").removeClass("current");$(this).addClass("current");$(e.events).trigger("onToonUnselected");$(e.events).trigger("onToonSelectionChanged",[null])})};this.createAddPanel=function(t){return $("<li/>").addClass("add").text("+").click(function(){var n=prompt(lang("Enter the name of the toon you wish to create:"));if(n){var r={id:(new Date).valueOf(),name:n,rod:"tg",fishes:[]};var i=e.getToons();i[r.id]=r;localStorage.toons=JSON.stringify(i);var s=e.createToonPanel(r).insertBefore(this);if(t){s.click(function(){t.call(this,r)}).click()}}})};this.getToons=function(){return localStorage.toons?JSON.parse(localStorage.toons):{}};this.render=function(t){var n=$("<ul/>").addClass("toonlist").appendTo(t);var r=e.createUnselectPanel().appendTo(n);var i=e.getToons();for(var s in i)e.createToonPanel(i[s]).appendTo(n);if(n.find(".current").length==0)r.addClass("current");return n}}function g(){var e=this;this.render=function(t){var n=$("<ul/>").addClass("minitoonlist").appendTo(t);var r=e.createUnselectPanel().appendTo(n);var i=e.getToons();for(var s in i)e.createToonPanel(i[s]).appendTo(n).text(i[s].name);if(n.find(".current").length==0)r.addClass("current");return n}}function y(){var e=this;this.render=function(t){t=$(t);var r=function(r){function x(){$(this).stop(true,true).animate({opacity:"0"},150).animate({opacity:"1"},150).animate({opacity:"0"},150).animate({opacity:"1"},150);r.name=c.val();r.rod=p.val();r.fishes=[];m.find("input:checked").each(function(){r.fishes.push(parseInt($(this).attr("x-fishid")))});var t=e.getToons();if(r.id in t)t[r.id]=r;localStorage.toons=JSON.stringify(t);$("#toon_"+r.id+">.name").text(r.name);$("#toon_"+r.id+">.rod").text(n[r.rod]);$("#toon_"+r.id+">.fishes").text(r.fishes.length+"/"+i[r.rod]+" species")}t.find("form").remove();var a=$("<form/>").submit(function(){return false}).appendTo(t);var f=$("<h2/>").appendTo(a).text(lang("Edit selected toon"));var l=$("<p/>").appendTo(a).text(lang("Toon's name")).append("<br/>");var c=$('<input type="text"/>').appendTo(l).css({width:"400px",marginTop:"5px"}).val(r.name);var h=$("<p/>").appendTo(a).text(lang("Rod")).append("<br/>");var p=$('<select size="1"/>').appendTo(h).css({width:"400px",marginTop:"5px"});for(var d in n)$("<option/>").appendTo(p).attr("value",d).text(n[d]);p.val(r.rod);var v=$("<p/>").appendTo(a).text(lang("Caught fish species")).append("<br/>");var m=$("<ul/>").appendTo(v).addClass("minifishlist");for(var g=0;g<o.length;g++){var y=o[g];var b=$("<li/>").appendTo(m).attr("x-fishid",y);var w=$("<label/>").appendTo(b).addClass("fishgroup_"+(y>>4));var E=$('<input type="checkbox"/>').appendTo(w).attr("x-fishid",y).attr("value","1");for(var S=0;S<r.fishes.length;S++)if(r.fishes[S]==y){E.attr("checked","checked");break}w.append(document.createTextNode(" "+s[y]))}p.change(function(){$(".minifishlist li").removeClass("cantcatch");var e=$(this).val();for(var t in u)if(u[t].indexOf(e)<0)$(".minifishlist li[x-fishid="+t+"]").addClass("cantcatch")}).change();c.change(x);p.change(x);m.find("input").change(x);var T=$("<p/>").css({margin:"0 -50px",padding:"20px 50px",background:"#222"}).insertAfter(f);$('<button type="button"/>').appendTo(T).text(lang("Delete toon")).click(function(){if(confirm(lang("Really delete $?").replace(/\$/g,r.name))){var n=e.getToons();if(r.id in n)delete n[r.id];localStorage.toons=JSON.stringify(n);$("#toon_"+r.id).remove();t.find(".none").addClass("current");a.remove()}})};var a=$("<ul/>").addClass("toonlist").appendTo(t);var f=e.createUnselectPanel().appendTo(a).click(function(){t.find("form").remove()});var l=e.getToons();for(var c in l){e.createToonPanel(l[c]).appendTo(a).click(function(e){return function(){r(e)}}(l[c]))}e.createAddPanel(r).appendTo(a);if(a.find(".current").length==0)f.addClass("current");return a}}function b(t,n){t=$(t).empty();var r=typeof Storage!=="undefined"&&localStorage.toons?JSON.parse(localStorage.toons):{};if(Object.keys(r).length>0){var i=parseInt(localStorage.currentToonId);if(!isNaN(i)&&i in r){$("<p/>").appendTo(t).addClass("status").text(lang("Doing some awesome mathematical computations ..."));(new v(t,n)).fetchAndRender(r[i].rod,r[i].fishes)}else{$("<p/>").appendTo(t).css("margin","30px 110px").text(lang("Please pick a toon which should be advised."));var s=new m;$(s.events).on("onToonSelected",S);s.render(t).css("margin","0 100px")}}else{var o=$("<p/>").addClass("status").appendTo(t);o.append(document.createTextNode(lang("You have not created any toons yet. Head over to the ")));$("<a/>").appendTo(o).attr("href",e+"toons.html").text(lang("toon management panel"));o.append(document.createTextNode(lang(" and create a toon there before returning to the Advisor.")))}}function w(e){if(typeof Storage==="undefined"){$("<p/>").appendTo(e).addClass("error").text(lang("We're sorry but your web browser does not support the necessary HTML5 features. Please upgrade your browser."));return}(new y).render(e)}function E(t){var n=typeof Storage!=="undefined"&&localStorage.toons?JSON.parse(localStorage.toons):{};if(Object.keys(n).length>0){var r=new m;$(r.events).on("onToonSelectionChanged",function(e,t){S()});r.render(t)}else{var i=$("<p/>").addClass("status").appendTo(t);i.append(document.createTextNode(lang("You have not created any toons yet. Head over to the ")));$("<a/>").appendTo(i).attr("href",e+"toons.html").text(lang("toon management panel"));i.append(document.createTextNode(lang(" and create a toon there.")))}}function S(){if(typeof Storage==="undefined")return;var e=localStorage.toons?JSON.parse(localStorage.toons):{};var r=parseInt(localStorage.currentToonId);$("table.pondorfishlist").each(function(){if($(this).find("tbody:hidden").length==0){$(this).find("tbody").clone().hide().appendTo(this)}else{$(this).find("tbody:visible").remove();$(this).find("tbody").clone().show().prependTo(this)}});$("ul.fishgroup>li").removeClass("caught cantcatch");$(".minitoonlist>li").removeClass("current");if(Object.keys(e).length==0)$("#toon_fish_status").parent().remove();if(Object.keys(e).length>0&&!isNaN(r)&&r in e){$("#toon_"+r).addClass("current");var i=e[r].rod;var o=e[r].fishes;for(var u=0;u<o.length;u++){$("ul.fishgroup>li.fish_"+o[u]).addClass("caught");$("table.fishlist>tbody:visible>#fish_"+o[u]).remove()}$("ul.fishgroup>li.cantcatch_"+i).addClass("cantcatch");$("#toon_fish_status").each(function(){var t=$("<span/>").appendTo($(this).empty());var n=$(this).data("fishid");var i=$("<a/>").addClass("catchbutton").attr("href","javascript:;");if(o.indexOf(n)>=0){$(t).text(f);i.text(c)}else{$(t).text(l);i.text(h)}i.appendTo(this).click(function(){if(d(r,n)){e[r].fishes.push(n);$(t).text(f);$(this).text(c)}else{$(t).text(l);$(this).text(h)}})});$(".fishlist tr:visible").each(function(){var e=this;var t=$(this).data("id");$("<button/>").prependTo($(this).find(".name")).addClass("catchbutton").text(p).click(function(){d(r,t,true);var n=$("<tr/>").insertAfter(e).css("height","40px");var i=$("<td/>").appendTo(n).attr("colspan","3").css("text-align","center").text(lang("Caught $.").replace(/\$/g,s[t])+" ");$("<a/>").appendTo(i).attr("href","javascript:;").text(lang("Undo?")).click(function(){$(e).insertBefore(n);n.remove();d(r,t,false)});$(e).detach()})});if(i!=t){$("table.pondorfishlist>tbody:visible").each(function(){$(this).find("tr").hide();var e=$("<tr/>").prependTo(this);var r=$("<td/>").appendTo(e).attr("colspan","3").css({height:"300px",textAlign:"center",lineHeight:"150%"});r.append(document.createTextNode(lang("You have selected to display statistics for the ")));$("<b/>").appendTo(r).text(n[t]);r.append(document.createTextNode(lang(" rod, but your toon owns the ")));$("<b/>").appendTo(r).text(n[i]);r.append(document.createTextNode(lang(" rod.")));r.append("<br/>");r.append(document.createTextNode(lang("The resulting probabilities will not be correct for your toon.")));var s=$("<p/>").appendTo(r);$("<button/>").appendTo(s).addClass("rodbutton rod_"+t).text(lang("Stick with $ nevertheless").replace(/\$/g,n[t])).click(function(){e.remove();$("table.pondorfishlist>tbody:visible>tr").show()});s.append(" ");$("<button/>").appendTo(s).addClass("rodbutton toonrodbutton rod_"+i).text(lang("Show me the $ statistics for my toon").replace(/\$/g,n[i])).click(function(){r.text(lang("Getting you there ..."));location.href="?rid="+i})})}}else{$(".minitoonlist>.none").addClass("current");$("#toon_fish_status").text(lang("← select a toon"))}$("#pond_advisor_control").each(function(){b(this,"pond")});$("#species_advisor_control").each(function(){b(this,"fish")})}function x(r){r=$(r);var i=r.closest(".pondorfishlist");var o,u;if(i.is(".pondlist")){o=i.data("fid");u=r.closest("tr").data("id")}else{o=r.closest("tr").data("id");u=i.data("pid")}var f=r.text()+" (?)";$("<a/>").appendTo(r.empty()).attr("href","javascript:;").text(f).click(function(){var r=T().text(lang("Doing some awesome mathematical computations ..."));$.getJSON(e+"buckets.json",{rid:t,fid:o,pid:u}).done(function(e){r.empty();$("<h3/>").appendTo(r).text(lang("What does this number mean?")).css("margin",0);$("<p/>").appendTo(r).text(lang("It states that you will most likely need to fish at most $N buckets at the pond in $P to catch the $F.").replace(/\$N/g,e[t].buckets).replace(/\$F/g,s[o]).replace(/\$P/g,a[u]));$("<p/>").appendTo(r).text(lang("These do not have to be fished continously, so you are allowed to leave the pond and fish somewhere else or quit the game."));var i=$("<p/>").appendTo(r).addClass("important").attr("x-lang-important",lang("Important!")).text(lang("Only buckets caught at *this pond* with *this rod* can be included."));if(Object.keys(e).length>1){i.append(document.createTextNode(" "+lang("Buckets fished with previous rods can be converted as follows.")));var f=$("<table/>").appendTo(r).addClass("datatable");var l=$("<tr/>").appendTo($("<thead/>").appendTo(f));$("<th/>").appendTo(l).text(lang("1 bucket with rod ..."));$("<th/>").appendTo(l).text(lang("corresponds to ... with $.").replace(/\$/g,n[t]));var c=$("<tbody/>").appendTo(f);for(var h in e){if(h==t)continue;var l=$("<tr/>").appendTo(c);$("<td/>").appendTo(l).text(n[h]);$("<td/>").appendTo(l).text(lang("$ buckets").replace(/\$/g,e[h].bucket_factor))}$("<p/>").appendTo(r).addClass("important").attr("x-lang-important",lang("Important!")).text(lang("These conversion rules only apply to this species at this pond!"))}}).fail(function(e,t,n){r.text(lang("Failed to retrieve data: ")+t+", "+n)})})}function T(){function n(){t.animate({marginTop:"+=30px"},300);e.fadeOut(300,function(){$(this).remove()})}var e=$("<div/>").appendTo("body").hide().addClass("modal-bg");var t=$("<div/>").appendTo(e).addClass("modal");$("<button/>").appendTo(t).addClass("close").click(n);e.click(n).fadeIn(300);t.animate({marginTop:"+=30px"},300);return $("<div/>").appendTo(t)}var n={tg:lang("Twig"),bm:lang("Bamboo"),hw:lang("Hardwood"),st:lang("Steel"),gd:lang("Gold")};var r="gd";var i={tg:38,bm:49,hw:60,st:69,gd:70};var s={0:lang("Balloon Fish"),1:lang("Hot Air Balloon Fish"),2:lang("Weather Balloon Fish"),3:lang("Water Balloon Fish"),4:lang("Red Balloon Fish"),32:lang("Cat Fish"),33:lang("Siamese Cat Fish"),34:lang("Alley Cat Fish"),35:lang("Tabby Cat Fish"),36:lang("Tom Cat Fish"),64:lang("Clown Fish"),65:lang("Sad Clown Fish"),66:lang("Party Clown Fish"),67:lang("Circus Clown Fish"),96:lang("Frozen Fish"),128:lang("Star Fish"),129:lang("Five Star Fish"),130:lang("Rock Star Fish"),131:lang("Shining Star Fish"),132:lang("All Star Fish"),160:lang("Holey Mackerel"),192:lang("Dog Fish"),193:lang("Bull Dog Fish"),194:lang("Hot Dog Fish"),195:lang("Dalmatian Dog Fish"),196:lang("Puppy Dog Fish"),224:lang("Amore Eel"),225:lang("Electric Amore Eel"),256:lang("Nurse Shark"),257:lang("Clara Nurse Shark"),258:lang("Florence Nurse Shark"),288:lang("King Crab"),289:lang("Alaskan King Crab"),290:lang("Old King Crab"),320:lang("Moon Fish"),321:lang("Full Moon Fish"),322:lang("Half Moon Fish"),323:lang("New Moon Fish"),324:lang("Crescent Moon Fish"),325:lang("Harvest Moon Fish"),352:lang("Sea Horse"),353:lang("Rocking Sea Horse"),354:lang("Clydesdale Sea Horse"),355:lang("Arabian Sea Horse"),384:lang("Pool Shark"),385:lang("Kiddie Pool Shark"),386:lang("Swimming Pool Shark"),387:lang("Olympic Pool Shark"),416:lang("Brown Bear Acuda"),417:lang("Black Bear Acuda"),418:lang("Koala Bear Acuda"),419:lang("Honey Bear Acuda"),420:lang("Polar Bear Acuda"),421:lang("Panda Bear Acuda"),422:lang("Kodiac Bear Acuda"),423:lang("Grizzly Bear Acuda"),448:lang("Cutthroat Trout"),449:lang("Captain Cutthroat Trout"),450:lang("Scurvy Cutthroat Trout"),480:lang("Piano Tuna"),481:lang("Grand Piano Tuna"),482:lang("Baby Grand Piano Tuna"),483:lang("Upright Piano Tuna"),484:lang("Player Piano Tuna"),512:lang("Peanut Butter & Jellyfish"),513:lang("Grape PB&J Fish"),514:lang("Crunchy PB&J Fish"),515:lang("Strawberry PB&J Fish"),516:lang("Concord Grape PB&J Fish"),544:lang("Devil Ray")};var o=[0,1,2,3,4,512,513,514,515,516,32,33,34,35,36,64,65,66,67,96,128,129,130,131,132,160,192,193,194,195,196,544,224,225,256,257,258,288,289,290,320,321,322,323,324,325,352,353,354,355,384,385,386,387,416,417,418,419,420,421,422,423,448,449,450,480,481,482,483,484];var u={0:["tg","bm","hw","st","gd"],1:["tg","bm","hw","st","gd"],2:["tg","bm","hw","st","gd"],3:["tg","bm","hw","st","gd"],4:["tg","bm","hw","st","gd"],512:["tg","bm","hw","st","gd"],513:["tg","bm","hw","st","gd"],514:["tg","bm","hw","st","gd"],515:["tg","bm","hw","st","gd"],516:["tg","bm","hw","st","gd"],32:["tg","bm","hw","st","gd"],33:["tg","bm","hw","st","gd"],34:["bm","hw","st","gd"],35:["tg","bm","hw","st","gd"],36:["bm","hw","st","gd"],64:["tg","bm","hw","st","gd"],65:["tg","bm","hw","st","gd"],66:["tg","bm","hw","st","gd"],67:["tg","bm","hw","st","gd"],96:["bm","hw","st","gd"],128:["tg","bm","hw","st","gd"],129:["tg","bm","hw","st","gd"],130:["bm","hw","st","gd"],131:["tg","bm","hw","st","gd"],132:["tg","bm","hw","st","gd"],160:["bm","hw","st","gd"],192:["bm","hw","st","gd"],193:["gd"],194:["tg","bm","hw","st","gd"],195:["tg","bm","hw","st","gd"],196:["tg","bm","hw","st","gd"],544:["tg","bm","hw","st","gd"],224:["tg","bm","hw","st","gd"],225:["tg","bm","hw","st","gd"],256:["tg","bm","hw","st","gd"],257:["tg","bm","hw","st","gd"],258:["tg","bm","hw","st","gd"],288:["tg","bm","hw","st","gd"],289:["bm","hw","st","gd"],290:["tg","bm","hw","st","gd"],320:["tg","bm","hw","st","gd"],321:["st","gd"],322:["bm","hw","st","gd"],323:["tg","bm","hw","st","gd"],324:["tg","bm","hw","st","gd"],325:["hw","st","gd"],352:["hw","st","gd"],353:["st","gd"],354:["st","gd"],355:["st","gd"],384:["hw","st","gd"],385:["bm","hw","st","gd"],386:["bm","hw","st","gd"],387:["bm","hw","st","gd"],416:["hw","st","gd"],417:["hw","st","gd"],418:["hw","st","gd"],419:["hw","st","gd"],420:["hw","st","gd"],421:["st","gd"],422:["st","gd"],423:["st","gd"],448:["tg","bm","hw","st","gd"],449:["tg","bm","hw","st","gd"],450:["tg","bm","hw","st","gd"],480:["st","gd"],481:["st","gd"],482:["hw","st","gd"],483:["hw","st","gd"],484:["hw","st","gd"]};var a={tc:lang("Toontown Central"),tc_pp:lang("Punchline Place"),tc_ss:lang("Silly Street"),tc_ll:lang("Loopy Lane"),dd:lang("Donald's Dock"),dd_bb:lang("Barnacle Boulevard"),dd_ll:lang("Lighthouse Lane"),dd_ss:lang("Seaweed Street"),dg:lang("Daisy Gardens"),dg_es:lang("Elm Street"),dg_ms:lang("Maple Street"),dg_os:lang("Oak Street"),mm:lang("Minnie's Melodyland"),mm_aa:lang("Alto Avenue"),mm_bb:lang("Baritone Boulevard"),mm_tt:lang("Tenor Terrace"),tb:lang("The Brrrgh"),tb_ss:lang("Sleet Street"),tb_ww:lang("Walrus Way"),tb_pp:lang("Polar Place"),dl:lang("Donald's Dreamland"),dl_ll:lang("Lullaby Lane"),dl_pp:lang("Pajama Place"),ee:lang("Estate")};var f=lang("has caught this fish species ");var l=lang("has not caught this fish species yet ");var c=lang("(undo)");var h=lang("(catch now)");var p=lang("Catch now!");g.prototype=new m;g.prototype.constructor=g;y.prototype=new m;y.prototype.constructor=y;$("ul.fishgroup>li").attr("x-lang-caught",lang("caught")).attr("x-lang-cantcatch",lang("can't catch"));$(".rodlist").attr("x-lang-change",lang("(change)"));$(".omx").each(function(){var e=$(this).text().replace(/DOT/g,".").replace(/AT/g,"@");$(this).attr("href","mailto:"+e).text(e)});S();$("#toon_selection").each(function(){var e=new g;$(e.events).on("onToonSelectionChanged",function(e,t){S()});e.render(this)});$("#toons_mgmt_control").each(function(){w(this)});$("#toons_control").each(function(){E(this)});$(".pondorfishlist .probability small").each(function(){x(this)});$(".rodlist").click(function(e){$(this).toggleClass("hover");e.stopPropagation()});$(document).click(function(){$(".rodlist").removeClass("hover")})}